local Players = game:GetService("Players")

local plr = Players.LocalPlayer
local playerGui = plr:WaitForChild("PlayerGui")

local function getCharacter(targetPlayer)
	local char = targetPlayer.Character or targetPlayer.CharacterAdded:Wait()
	local hrp = char:FindFirstChild("HumanoidRootPart") or char:WaitForChild("HumanoidRootPart", 10)
	return char, hrp
end

local screengui = playerGui:FindFirstChild("TurquoizViewer")
local scrollingframe
local minimiseButton
local closeButton
local isMinimized = false
local orgSize
local minSize = UDim2.new(0.05, 0, 0.05, 0)

local function createPlayerButton(parent, targetPlayer)
	local button = Instance.new("TextButton")
	button.Name = targetPlayer.Name
	button.Text = targetPlayer.DisplayName .. " (" .. targetPlayer.Name .. ")"
	button.Size = UDim2.new(1, -10, 0, 30)
	button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
	button.TextColor3 = Color3.fromRGB(255, 255, 255)
	button.Font = Enum.Font.SourceSansBold
	button.TextSize = 18
	button.BorderSizePixel = 0
	button.Parent = parent

	button.MouseButton1Click:Connect(function()
		local _, targetHrp = getCharacter(targetPlayer)
		local _, myHrp = getCharacter(plr)

		if targetHrp and myHrp then
			myHrp.CFrame = targetHrp.CFrame + Vector3.new(0, 3, 0)
		else
			warn("Could not teleport â€” missing HRP for one of the players.")
		end
	end)
end

local function refreshPlayerList()
	scrollingframe:ClearAllChildren()

	local layout = Instance.new("UIListLayout")
	layout.Padding = UDim.new(0, 4)
	layout.Parent = scrollingframe
	layout.FillDirection = Enum.FillDirection.Vertical
	layout.SortOrder = Enum.SortOrder.LayoutOrder

	for _, p in ipairs(Players:GetPlayers()) do
		if p ~= plr then
			createPlayerButton(scrollingframe, p)
		end
	end
end

local function create()
	screengui = Instance.new("ScreenGui")
	screengui.Name = "TurquoizViewer"
	screengui.ResetOnSpawn = false
	screengui.IgnoreGuiInset = true
	screengui.Parent = playerGui

	scrollingframe = Instance.new("ScrollingFrame")
	scrollingframe.Name = "ViewerFrame"
	scrollingframe.Parent = screengui
	scrollingframe.Size = UDim2.new(0.15, 0, 0.25, 0)
	scrollingframe.Position = UDim2.new(0.35, 0, 0.25, 0)
	scrollingframe.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	scrollingframe.BackgroundTransparency = 0.1
	scrollingframe.BorderSizePixel = 0
	scrollingframe.ScrollBarThickness = 8
	scrollingframe.AutomaticCanvasSize = Enum.AutomaticSize.Y
	scrollingframe.ScrollingDirection = Enum.ScrollingDirection.Y
	scrollingframe.ScrollBarImageColor3 = Color3.fromRGB(0, 170, 255)
	scrollingframe.ScrollBarImageTransparency = 0.3

	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, 6)
	corner.Parent = scrollingframe

	local dragDetector = Instance.new("UIDragDetector")
	dragDetector.Parent = scrollingframe

	orgSize = scrollingframe.Size

	-- Minimize button
	minimiseButton = Instance.new("TextButton")
	minimiseButton.Parent = scrollingframe
	minimiseButton.Size = UDim2.new(0.06, 0, 0.07, 0)
	minimiseButton.Position = UDim2.new(0.8, 0, 0.05, 0)
	minimiseButton.Text = "-"
	minimiseButton.BackgroundColor3 = Color3.fromRGB(255, 255, 0)
	minimiseButton.TextScaled = true
	minimiseButton.ZIndex = 5

	-- Close button
	closeButton = Instance.new("TextButton")
	closeButton.Parent = scrollingframe
	closeButton.Size = UDim2.new(0.06, 0, 0.07, 0)
	closeButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
	closeButton.Text = "X"
	closeButton.Position = UDim2.new(0.8, 0, 0.127, 0)
	closeButton.ZIndex = 5

	closeButton.Activated:Connect(function()
		if screengui then
			screengui:Destroy()
		end
		if script then
			script:Destroy()
		end
	end)

	minimiseButton.Activated:Connect(function()
		if not isMinimized then
			scrollingframe.Size = minSize
			for _, i in scrollingframe:GetChildren() do
				if i == minimiseButton or i == closeButton or i.Name == "UICorner" or i.Name == "UIDragDetector" then
					if i == minimiseButton then
						i.Size = UDim2.new(0.5, 0, 0.5, 0)
						i.Position = UDim2.new(0, 0, 0, 0)
						i.Visible = true
					elseif i == closeButton then
						i.Size = UDim2.new(0.5, 0, 0.5, 0)
						i.Position = UDim2.new(0, 0, 0.5, 0)
						i.Visible = true
					end
				else
					i.Visible = false
				end
			end
			isMinimized = true
			scrollingframe.Position = UDim2.new(-0.014166, 0, 0.7, 0)
		else
			scrollingframe.Size = orgSize
			for _, i in scrollingframe:GetChildren() do
				if i == minimiseButton or i == closeButton or i.Name == "UICorner" or i.Name == "UIDragDetector" then
					if i == minimiseButton then
						i.Size = UDim2.new(0.06, 0, 0.07, 0)
						i.Position = UDim2.new(0.8, 0, 0.05, 0)
						i.Visible = true
					elseif i == closeButton then
						i.Size = UDim2.new(0.06, 0, 0.07, 0)
						i.Position = UDim2.new(0.8, 0, 0.127, 0)
						i.Visible = true
					end
				else
					i.Visible = true
				end
			end
			isMinimized = false
		end
	end)

	refreshPlayerList()
end

if screengui then
	screengui:Destroy()
end
create()

Players.PlayerAdded:Connect(refreshPlayerList)
Players.PlayerRemoving:Connect(refreshPlayerList)
