local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")

local plr = Players.LocalPlayer
local playerGui = plr:WaitForChild("PlayerGui")

local function getCharacter(targetPlayer)
	local char = targetPlayer.Character or targetPlayer.CharacterAdded:Wait()
	local hrp = char:FindFirstChild("HumanoidRootPart") or char:WaitForChild("HumanoidRootPart", 10)
	return char, hrp
end

local screengui = playerGui:FindFirstChild("TurquoizViewer")
local scrollingframe

local function makeDraggable(frame)
	local dragging = false
	local dragStart, startPos

	frame.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			dragStart = input.Position
			startPos = frame.Position

			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)

	UserInputService.InputChanged:Connect(function(input)
		if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
			local delta = input.Position - dragStart
			frame.Position = UDim2.new(
				startPos.X.Scale,
				startPos.X.Offset + delta.X,
				startPos.Y.Scale,
				startPos.Y.Offset + delta.Y
			)
		end
	end)
end

local function createPlayerButton(parent, targetPlayer)
	local button = Instance.new("TextButton")
	button.Name = targetPlayer.Name
	button.Text = targetPlayer.DisplayName .. " (" .. targetPlayer.Name .. ")"
	button.Size = UDim2.new(1, -10, 0, 30)
	button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
	button.TextColor3 = Color3.fromRGB(255, 255, 255)
	button.Font = Enum.Font.SourceSansBold
	button.TextSize = 18
	button.BorderSizePixel = 0
	button.Parent = parent

	button.MouseButton1Click:Connect(function()
		local _, targetHrp = getCharacter(targetPlayer)
		local _, myHrp = getCharacter(plr)

		if targetHrp and myHrp then
			myHrp.CFrame = targetHrp.CFrame + Vector3.new(0, 3, 0)
		else
			warn("Could not teleport â€” missing HRP for one of the players.")
		end
	end)
end

local function refreshPlayerList()
	scrollingframe:ClearAllChildren()

	local layout = Instance.new("UIListLayout")
	layout.Padding = UDim.new(0, 4)
	layout.FillDirection = Enum.FillDirection.Vertical
	layout.SortOrder = Enum.SortOrder.LayoutOrder
	layout.Parent = scrollingframe

	for _, p in ipairs(Players:GetPlayers()) do
		if p ~= plr then
			createPlayerButton(scrollingframe, p)
		end
	end
end

local function create()
	screengui = Instance.new("ScreenGui")
	screengui.Name = "TurquoizViewer"
	screengui.ResetOnSpawn = false
	screengui.IgnoreGuiInset = true
	screengui.Parent = playerGui

	scrollingframe = Instance.new("ScrollingFrame")
	scrollingframe.Name = "ViewerFrame"
	scrollingframe.Parent = screengui
	scrollingframe.Size = UDim2.new(0.15, 0, 0.25, 0)
	scrollingframe.Position = UDim2.new(0.35, 0, 0.25, 0)
	scrollingframe.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	scrollingframe.BackgroundTransparency = 0.1
	scrollingframe.BorderSizePixel = 0
	scrollingframe.ScrollBarThickness = 8
	scrollingframe.AutomaticCanvasSize = Enum.AutomaticSize.Y
	scrollingframe.ScrollingDirection = Enum.ScrollingDirection.Y
	scrollingframe.ScrollBarImageColor3 = Color3.fromRGB(0, 170, 255)
	scrollingframe.ScrollBarImageTransparency = 0.3

	makeDraggable(scrollingframe)
	refreshPlayerList()
end

if screengui then
	screengui:Destroy()
end
create()

Players.PlayerAdded:Connect(refreshPlayerList)
Players.PlayerRemoving:Connect(refreshPlayerList)
